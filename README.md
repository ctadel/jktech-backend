# ctadel-library (Backend)

A FastAPI-based backend service for document ingestion, querying, and user management. It powers the ctadel-library platform, where users can upload public documents (e.g., eBooks, research papers, movie scripts), engage in AI-assisted conversations over content, and interact through bookmarks and more.

Frontend repo: [ctadel/wlib-frontend](https://github.com/ctadel/wlib-frontend)

---

## ğŸŒ Overview

This project provides:

* Document management (upload, re-upload, versioning, delete)
* Public/private document access
* LLM-backed querying on document content (LLM is treated as a black box)
* Conversation tracking with archiving and deletion
* Star/bookmark documents
* Role-based access control with JWT
* Super admin dashboard for user/document oversight

Target audience includes researchers, movie reviewers, students, and interviewees seeking quick document insights.

---

## ğŸ› ï¸ Features

* User registration, login, JWT-based authentication
* Role support: user, editor, admin, super admin
* Public document sharing and querying
* Conversation logging per document per user
* Admin-level user and document controls
* Starred documents/bookmarks
* Modular service layout for maintainability

---

## ğŸ“Š Tech Stack

* **Language:** Python 3.11
* **Framework:** FastAPI 0.115
* **Database:** PostgreSQL (SQLite fallback for local/dev)
* **ORM:** SQLAlchemy + Alembic for migrations
* **Storage:** Amazon S3 or local filesystem
* **Authentication:** JWT
* **Testing:** Pytest
* **Middleware:** Custom access log middleware, CORS

---

## ğŸ›‹ï¸ Project Structure

```
.
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/                    # Root API router
â”‚   â”œâ”€â”€ common/                 # Auth, DB, middleware, config
â”‚   â”œâ”€â”€ main.py                # FastAPI app setup
â”‚   â””â”€â”€ modules/               # Users, documents, conversations
â”‚       â”œâ”€â”€ conversations/     # Routes, service, tests
â”‚       â”œâ”€â”€ documents/         # CRUD, storage, versioning
â”‚       â””â”€â”€ users/             # Auth, role management
â”œâ”€â”€ run.py                     # App entrypoint
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .env.sample
â”œâ”€â”€ alembic.ini
â”œâ”€â”€ alembic/
â”œâ”€â”€ test_e2e.py
â””â”€â”€ pytest.ini
```

---

## âš¡ Installation & Development

### 1. Clone & Run (Local Dev)

```bash
git clone https://github.com/ctadel/wlib-backend
cd wlib-backend
cp .env.sample .env
# Update .env with JWT_SECRET_KEY, CORS_ALLOWED_ORIGINS, DATABASE_URL
pip install -r requirements.txt
python run.py
```

### 2. Docker (Optional)

```bash
docker build -t wlib-backend .
docker run -p 8000:8000 --env-file .env wlib-backend
```

---

## ğŸ”‘ Required Environment Variables

```ini
# .env
JWT_SECRET_KEY=your-secret-key
CORS_ALLOWED_ORIGINS="*"
DATABASE_URL=postgresql+psycopg2://user:pass@host/dbname
```

SQLite fallback is used if `DATABASE_URL` is not provided.

---

## âœï¸ API Docs

Once running, visit: [http://localhost:8000/docs](http://localhost:8000/docs) (Swagger UI is auto-generated by FastAPI)

---

## ğŸŒŠ Testing

```bash
pytest
```

Tests include:

* Unit tests per module
* Route tests
* E2E test: `test_e2e.py`

## ğŸŒŠ Create Activity and demo users

This is already included in the docker-compose file in the main repository
but you can also run these scripts manually to create demo users and activity data.
This uses the FastAPI, so the app needs to be up and running
Update the variable `API_URL` in the .env file to point to the running app.

Example `.env` for scripts:

```.env
API_URL=http://localhost:8000
```

Then run the scripts:

```bash
# This script creates demo users basic:password, premium:password, moderator:password
python scripts/create_demo_users.py

# This script creates activity for n users and documents
python scripts/create_activity.py --users 100 --documents 20000
```

---

## ğŸŒ Deployment Notes

Recommended production setup:

### Security

* Use **HTTPS** (e.g., behind NGINX or a cloud load balancer)
* Store secrets securely (e.g., `.env` or a secrets manager)
* Rate-limit auth endpoints
* Log and monitor with tools like Sentry or Prometheus

### Scalability

* Use **Gunicorn** with Uvicorn workers:

  ```bash
  gunicorn -k uvicorn.workers.UvicornWorker app.main:app --bind 0.0.0.0:8000 --workers 4
  ```
* Containerize with Docker and deploy on:

  * AWS ECS / Fargate
  * Kubernetes
  * Railway / Render / Fly.io (for hobby scale)

### Suggested CI/CD Tools

* GitHub Actions with test + lint + Docker build + push to registry
* Alembic migrations run automatically on deploy

---

## ğŸ‘¤ Author

Maintained by [ctadel](https://github.com/ctadel)

---

## âœ‰ï¸ License

MIT License (or specify your preferred license)

---

## âœ¨ Example Use Cases

* Upload a research paper or college books and ask crazy
* Upload a movie script and generate a character map
* Star/Bookmark useful documents
* View and archive past conversations

---
